<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xhu.dao.LeaseDao">
    <select id="list" resultType="com.xhu.entity.Lease">
        SELECT *
        FROM lease
        WHERE 1 = 1
        <if test="lease.userId != null">
            AND user_id = #{lease.userId}
        </if>
        <if test="lease.toolId != null">
            AND tool_id = #{lease.toolId}
        </if>
        <if test="lease.leaseState != null">
            AND lease_state = #{lease.leaseState}
        </if>
        <if test="lease.companyId != null">
            AND company_id = #{lease.companyId}
        </if>
        AND create_time BETWEEN #{lease.fromTime} AND  #{lease.toTime}
        ORDER BY create_time DESC
        <if test=" index != null and size != null">
            limit #{index},#{size}
        </if>
    </select>

    <select id="getLease" resultType="com.xhu.entity.Lease">
        SELECT *
        FROM lease
        WHERE lease_id = #{leaseId}
    </select>

    <select id="getLeaseByTool" resultType="com.xhu.entity.Lease" parameterType="com.xhu.entity.Lease">
        SELECT *
        FROM lease
        WHERE tool_id = #{toolId} AND lease_state = #{leaseState}
    </select>

    <select id="getLeaseByUser" resultType="com.xhu.entity.Lease">
        SELECT *
        FROM lease
        WHERE tool_id = #{toolId} AND user_id = #{userId}
    </select>

    <select id="getCount" resultType="int" parameterType="com.xhu.entity.Lease">
        SELECT count(1)
        FROM lease
        WHERE 1 = 1
        <if test="userId != null">
            AND user_id = #{userId}
        </if>
        <if test="toolId != null">
            AND tool_id = #{toolId}
        </if>
        <if test="leaseState != null">
            AND lease_state = #{leaseState}
        </if>
        <if test="companyId != null">
            AND company_id = #{companyId}
        </if>
        AND create_time BETWEEN #{fromTime} AND  #{toTime}
    </select>

    <insert id="add" parameterType="com.xhu.entity.Lease">
        <selectKey keyProperty="leaseId" keyColumn="lease_id" resultType="java.lang.String"
                   order="BEFORE">
            select replace(uuid(),'-','') from dual
        </selectKey>
        insert into lease (lease_id,user_id,tool_id,company_id,lease_mes,lease_repay,lease_term,lease_state,total_money,create_time,end_time)
        values(#{leaseId},#{userId},#{toolId},#{companyId},#{leaseMes},#{leaseRepay},#{leaseTerm},#{leaseState},#{totalMoney},#{createTime},#{endTime})
    </insert>
    
    <update id="update" parameterType="com.xhu.entity.Lease">
        UPDATE lease
        <trim prefix="set" suffixOverrides=",">
            <if test="leaseState != null">
                lease_state = #{leaseState},
            </if>
        </trim>
        WHERE lease_id = #{leaseId}
    </update>

    <delete id="delete">
        DELETE FROM lease
        WHERE lease_id = #{leaseId}
    </delete>
</mapper>